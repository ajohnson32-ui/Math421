
---
output: 
  html_document:
  pdf_document: default
  word_document: default
title: "Assignment 13 - Optional: Writing a function - Conditional Statement"
---

***How to do it?***: 

- Open the Rmarkdown file of this assignment ([link](assignment13_optional.Rmd)) in Rstudio. 

- Right under each **question**, insert  a code chunk (you can use the hotkey `Ctrl + Alt + I` to add a code chunk) and code the solution for the question. 

- `Knit` the rmarkdown file (hotkey: `Ctrl + Alt + K`) to export an html.  

-  Publish the html file to your Githiub Page. 

***Submission***: Submit the link on Github of the assignment to Canvas

```{r setup, include=FALSE}
knitr::opts_chunk$set(message = FALSE)
```

-------

#### NOTICE: Question 7, 8 and 9 are optional. 

-------

1. Write a function to calculate the age of a person.  Give an example to test your function. 

- Input: a number, x, (year born)

- Output: Print out "You are r age". Where r is the age of the person, i.e. 2020 - x. 

Hint: [Similar Function](https://bryantstats.github.io/math421/gganimate/17_writing_functions.html#42)
```{r}
calculate_age <- function(x) {
  r <- 2020 - x
  print(paste("You are", r, "age"))
}

calculate_age(1998)

```

-------

2. Write the following function. Give an example to test your function. 

- Input: a number

- Output: print out: "You input an even number!" if the number is event, or "You input an odd number!" otherwise. 

Hint: [Similar Function](https://bryantstats.github.io/math421/gganimate/17_writing_functions.html#46)
```{r}
check_even_odd <- function(x) {
  if (x %% 2 == 0) {
    print("You input an even number!")
  } else {
    print("You input an odd number!")
  }
}

check_even_odd(10)
```

-------

3. Write the following function.  Give an example to test your function. 

- Input: a numeric vector 

- Output:  

  - if the input vector has missing values: return the input vector with missing values replaced by mean
  
  - if the input vector has no missing value: return the same input vector
  
Hint: [Similar Function](https://bryantstats.github.io/math421/gganimate/17_writing_functions.html#50)
```{r}
replace_na_mean <- function(x) {
  if (any(is.na(x))) {
    x[is.na(x)] <- mean(x, na.rm = TRUE)
  }
  return(x)
}

v1 <- c(2, 4, NA, 6, NA, 8)
replace_na_mean(v1)
```

-------

4. Write the following function.  Give an example to test your function. 

- Input: a vector x 

- Output:  The vector x where the missing values replaced by the mean (if x is numeric) or the mode (if x is non-numeric).  If x does not have missing value, return the same vector x.  

Hint: Use If-statement to combine the function in Question 3 and [this function](https://bryantstats.github.io/math421/gganimate/17_writing_functions.html#49)
```{r}
replace_na <- function(x) {
  if (!any(is.na(x))) {
    return(x)
  }
  if (is.numeric(x)) {
    x[is.na(x)] <- mean(x, na.rm = TRUE)
  } else {
    mode_value <- names(sort(table(x), decreasing = TRUE))[1]
    x[is.na(x)] <- mode_value
  }
  
  return(x)
}

x1 <- c(2, 4, NA, 6, NA)
replace_na(x1)
```

-------

5. Write the following function. Give examples to test your function. 

- Input: A data frame of two variables x and y

- Output: 

  - A boxplot of x by y if x is numeric and y is non-numeric
 
  - A boxplot of y by x if y is numeric and x is non-numeric
 
  - print out 'This function cannot visualize your data' otherwise

Hint: 

- [Similar Function](https://bryantstats.github.io/math421/gganimate/17_writing_functions.html#53)
 
- You can refer to this slide to plot a boxplot: https://bryantstats.github.io/math421/slides/6_viz.html#36
```{r}
boxplot_xy <- function(df) {
  
  x <- df[[1]]
  y <- df[[2]]
  
  if (is.numeric(x) & !is.numeric(y)) {
    boxplot(x ~ y,
            xlab = names(df)[2],
            ylab = names(df)[1],
            main = "Boxplot of x by y")
  } else if (is.numeric(y) & !is.numeric(x)) {
    boxplot(y ~ x,
            xlab = names(df)[1],
            ylab = names(df)[2],
            main = "Boxplot of y by x")
  } else {
    print("This function cannot visualize your data")
  }
}

df1 <- data.frame(
  x = c(10, 12, 9, 14, 11),
  y = c("A", "A", "B", "B", "A")
)

boxplot_xy(df1)

df2 <- data.frame(
  x = c("Low", "Low", "High", "High", "Low"),
  y = c(5, 7, 6, 9, 8)
)

boxplot_xy(df2)

df3 <- data.frame(
  x = c(1, 2, 3),
  y = c(4, 5, 6)
)

boxplot_xy(df3)
```
 
-------
 
6. Combine the function in Question 5 and the function in this example ([Link](https://bryantstats.github.io/math421/gganimate/17_writing_functions.html#53)) to have a function that can plot all possible cases (2 categorical, 2 numeric, 1 numeric and 1 categorical). 
```{r}
library(ggplot2)
library(dplyr)

viz_all <- function(d) {
  
  x <- d[[1]]
  y <- d[[2]]
  if (is.numeric(x) & is.numeric(y)) {
    d %>%
      ggplot(aes(x = x, y = y)) +
      geom_point() +
      labs(x = names(d)[1], y = names(d)[2])
  } else if (!is.numeric(x) & !is.numeric(y)) {
    d %>%
      ggplot(aes(x = x, fill = y)) +
      geom_bar(position = "dodge") +
      labs(x = names(d)[1], fill = names(d)[2])
  } else if (is.numeric(x) & !is.numeric(y)) {
    d %>%
      ggplot(aes(x = y, y = x)) +
      geom_boxplot() +
      labs(x = names(d)[2], y = names(d)[1])
  } else if (!is.numeric(x) & is.numeric(y)) {
    d %>%
      ggplot(aes(x = x, y = y)) +
      geom_boxplot() +
      labs(x = names(d)[1], y = names(d)[2])
  }
}

df1 <- data.frame(
  x = c(1, 2, 3, 4),
  y = c(4, 6, 5, 7)
)

viz_all(df1)

df2 <- data.frame(
  x = c("A", "A", "B", "B"),
  y = c("Yes", "No", "Yes", "No")
)

viz_all(df2)
```

-------

#### NOTICE: Question 7, 8 and 9 are optional. 

-------

7. Write the following function. Give examples to test your function. 

- Input: 

  - input_data: a clean data frame with a variable name `target`. The `target` variable is also binary. 
  
  - train_percent: a number presenting a proportion of training data. The default train_percent is .8

- Output: the accuracy of the decision model `rpart` where the training data is train_percent. 
```{r}
library(rpart)

rpart_accuracy <- function(input_data, train_percent = 0.8) {
  set.seed(123)
  n <- nrow(input_data)
  train_index <- sample(1:n, size = train_percent * n)
  train_data <- input_data[train_index, ]
  test_data  <- input_data[-train_index, ]
  model <- rpart(target ~ ., data = train_data, method = "class")
  pred <- predict(model, test_data, type = "class")
  accuracy <- mean(pred == test_data$target)
  return(accuracy)
}

set.seed(1)

df <- data.frame(
  x1 = rnorm(100),
  x2 = rnorm(100),
  target = sample(c(0, 1), 100, replace = TRUE)
)

rpart_accuracy(df)

rpart_accuracy(df, train_percent = 0.7)
```

-------

8. Write the following function. Give examples to test your function. 

- Input: 

  - input_data: a clean data frame with a variable name `target`. The `target` variable is also binary. 
  
  - train_percent: a number presenting a proportion of training data. The default train_percent is .8

- Output: the plot of variable important by random forest trained by caret. 
```{r}
library(caret)

rf_varimp_plot <- function(input_data, train_percent = 0.8) {
  
  set.seed(123)
  n <- nrow(input_data)
  train_index <- sample(1:n, size = train_percent * n)
  
  train_data <- input_data[train_index, ]
  test_data  <- input_data[-train_index, ]
  rf_model <- train(
    target ~ .,
    data = train_data,
    method = "rf",
    trControl = trainControl(method = "none")
  )
  var_imp <- varImp(rf_model)
  plot(var_imp, main = "Variable Importance (Random Forest)")
}

set.seed(1)

df <- data.frame(
  x1 = rnorm(200),
  x2 = rnorm(200),
  x3 = rnorm(200),
  target = sample(c(0, 1), 200, replace = TRUE)
)

rf_varimp_plot(df)

rf_varimp_plot(df, train_percent = 0.7)
```


---
9. Write the following function. Give examples to test your function. 

- Input: 

  - a data frame that has a text column 
  
  - the name of the text column in the data

- Output: the word cloud plot of the text column

Sample codes

- [Word Cloud codes](https://bryantstats.github.io/math421/assignments/text_mining_sample_codes2.html#Total_Word_Cloud)

- [A similar function](https://bryantstats.github.io/math421/gganimate/17_writing_functions.html#10)


```{r}
library(wordcloud)
library(tm)
library(RColorBrewer)

text_wordcloud <- function(data, text_col) {
  text <- data[[text_col]]
  corpus <- VCorpus(VectorSource(text))
  corpus <- tm_map(corpus, content_transformer(tolower))
  corpus <- tm_map(corpus, removePunctuation)
  corpus <- tm_map(corpus, removeNumbers)
  corpus <- tm_map(corpus, removeWords, stopwords("english"))
  corpus <- tm_map(corpus, stripWhitespace)
  tdm <- TermDocumentMatrix(corpus)
  m <- as.matrix(tdm)
  word_freq <- sort(rowSums(m), decreasing = TRUE)
  wordcloud(
    words = names(word_freq),
    freq = word_freq,
    min.freq = 1,
    colors = brewer.pal(8, "Dark2")
  )
}

df <- data.frame(
  review = c(
    "I love this product",
    "This product is great and useful",
    "I do not like this product",
    "Great value and great quality"
  )
)

text_wordcloud(df, "review")

df2 <- data.frame(
  comments = c(
    "Data science is fun",
    "R programming is powerful",
    "Machine learning with R is fun"
  )
)

text_wordcloud(df2, "comments")

```

