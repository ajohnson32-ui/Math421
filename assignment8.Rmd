
---
output: 
  html_document:
  pdf_document: default
  word_document: default
title: "Assignment 8: Visualization - Making a bar race"
---

***How to do it?***: 

- Open the Rmarkdown file of this assignment ([link](assignment8.Rmd)) in Rstudio. 

- Right under each **question**, insert  a code chunk (you can use the hotkey `Ctrl + Alt + I` to add a code chunk) and code the solution for the question. 

- `Knit` the rmarkdown file (hotkey: `Ctrl + Alt + K`) to export an html.  

-  Publish the html file to your Githiub Page. 

***Submission***: Submit the link on Github of the assignment to Canvas

```{r setup, include=FALSE}
knitr::opts_chunk$set(message = FALSE)
```


-------

1. Install two packages `gganimate` and `gifski` then restart Rstudio. Using the `Adult Census Income` data, make an animation using `geom_point` and `transition_states`.
```{r}
install.packages("gganimate")
install.packages("gifski")
```
```{r}
library(ggplot2)
library(gganimate)
library(dplyr)
```
```{r}
p <- ggplot(census, aes(x = age, y = hours_per_week, color = income)) +
  geom_point(alpha = 0.6) +
  labs(title = 'Income Level: {closest_state}',
       x = 'Age',
       y = 'Hours per Week') +
  theme_minimal() +
  transition_states(income, transition_length = 2, state_length = 1) +
  ease_aes('linear')
animate(p, nframes = 100, fps = 10)
```


2. Using the `Adult Census Income` data, make an animation using `geom_bar` and `transition_states`.
```{r}
census_counts <- census %>%
  group_by(education, income) %>%
  summarise(count = n(), .groups = "drop")
p <- ggplot(census_counts, aes(x = education, y = count, fill = income)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Income by Education Level: {closest_state}",
       x = "Education",
       y = "Count") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  transition_states(income, transition_length = 2, state_length = 1) +
  ease_aes('linear')
animate(p, nframes = 100, fps = 10)
```

3. Use the WHO's dataset at [this link](https://covid19.who.int/WHO-COVID-19-global-data.csv). Make a top-10 bar race by months between countries on the number of deaths by Covid 19 in 2021.
```{r}
covid <- read.csv("C:/Users/student/Downloads/WHO-COVID-19-global-daily-data.csv")
covid_2021 <- covid %>%
  mutate(Date_reported = ymd(Date_reported),
         year = year(Date_reported),
         month = floor_date(Date_reported, "month")) %>%
  filter(year == 2021) %>%
  group_by(month, Country) %>%
  summarise(deaths = sum(New_deaths, na.rm = TRUE), .groups = "drop")
monthly_top10 <- covid_2021 %>%
  group_by(month) %>%
  arrange(month, desc(deaths)) %>%
  slice_head(n = 10) %>%
  ungroup()
p <- ggplot(monthly_top10, aes(
      x = reorder_within(Country, deaths, month),
      y = deaths,
      fill = Country
    )) +
  geom_col(show.legend = FALSE) +
  scale_x_reordered() +
  coord_flip() +
  labs(
    title = "Top 10 Countries by COVID-19 Deaths per Month in 2021",
    subtitle = "Month: {format(frame_time, '%b %Y')}",
    x = "Country",
    y = "Monthly Deaths"
  ) +
  theme_minimal(base_size = 15) +
  transition_time(month) +
  ease_aes('cubic-in-out')

animate(p, nframes = 120, fps = 10, width = 800, height = 600)
```

4. Make a bar race using a dataset of your own interest. You may use the dataset that we use in class (https://covidtracking.com/data/download/all-states-history.csv) but you should make a different bar racev from ones in the slides. 
```{r}
who_2021 <- read.csv('https://covidtracking.com/data/download/all-states-history.csv')
who_2021 <- who %>%
  mutate(Date_reported = ymd(Date_reported),
         year = year(Date_reported),
         month = floor_date(Date_reported, "month")) %>%
  filter(year == 2021) %>%
  group_by(month, Country) %>%
  summarise(deaths = sum(New_deaths, na.rm = TRUE), .groups = "drop")
monthly_top10 <- who_2021 %>%
  group_by(month) %>%
  arrange(month, desc(deaths)) %>%
  slice_head(n = 10) %>%
  ungroup()
p <- ggplot(monthly_top10, aes(
      x = reorder_within(Country, deaths, month),
      y = deaths,
      fill = Country
    )) +
  geom_col(show.legend = FALSE) +
  scale_x_reordered() +
  coord_flip() +
  labs(
    title = "Top 10 Countries by COVIDâ€‘19 Deaths per Month in 2021",
    subtitle = "Month: {format(frame_time, '%b %Y')}",
    x = "Country",
    y = "Monthly Deaths"
  ) +
  theme_minimal(base_size = 15) +
  transition_time(month) +
  ease_aes('cubic-in-out')
animate(p, nframes = 120, fps = 10, width = 800, height = 600)
```

